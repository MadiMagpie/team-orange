<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Twitter Login</title>
  <link rel="stylesheet" href="styles/login.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

</head>

<body>
  <div class="wrapper">
    <div class="main">
      
      <div class="left">
        <img class="orangelogo" src="images/orange-slice.png" />
      </div>

      <div class="right">
        
        <div id="firstBox">
          <h1> Join Twitter Today </h1>
          <img src="images/avatar.png" />
          
          <div id="inputs">
            <input type="email" id="email" placeholder="Email" required>
            <input type="password" id="password" placeholder="Password" required>
          </div>

          <div id = buttonCont>
            <button id = button onclick= "Login()" >Log In</button>
            <p>Don't have an account?</p>
            <button id = button onclick="Register()" >Sign Up</button>
          </div>
          
          <div id="or">
            <hr />
            <p>OR</p>
            <hr />
          </div>
          
          
            <button id="googleLogin" onclick="googleLogin()">
              <img src="https://img.icons8.com/color/48/null/google-logo.png"/>
              Log in with Google
            </button>

        </div>
        <!--closing firstBox -->    
      
      </div>
      <!--closing right -->
    
    </div>
    <!--closing main -->

  </body>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    import { getAuth } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js"

    const firebaseConfig = {
        apiKey: "AIzaSyDCdhgsnlKAE2WQFkUuyo1luajKvvleDW8",
        authDomain: "orange-32123.firebaseapp.com",
        databaseURL: "https://orange-32123-default-rtdb.firebaseio.com",
        projectId: "orange-32123",
        storageBucket: "orange-32123.appspot.com",
        messagingSenderId: "293771634914",
        appId: "1:293771634914:web:5fb87a0e00d6afee6ed6bb"
    };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth();
      const database = getDatabase();

      // Set up register function
      function Register() {
          // Get all input fields
          email = document.getElementById('email').value
          password = document.getElementById('password').value
          
          //validate input fields
          if (validate_email(email) == false || validate_password(password) == false){
              alert('Email or Password is not correct') 
          }

          // Authentication
          auth.createUserWithEmailAndPassword(email, password)
          .then(function(){

              var user = auth.currentUser

              // Add this user to Firebase Database
              var database_ref = database.ref()

              //Create User data
              var user_data = {
                  email: email,
                  last_login: Date.now()
              }

              database_ref.child('users/' + user.uid).set(user_data)


              alert('User Created')

          })
          .catch(function(error){
              var error_code = error.code
              var error_message = err.message

              alert(error_message)
          })

          
      }

      // Set up login function
      function Login() {
          email = document.getElementById('email').value
          password = document.getElementById('password').value

          // Validate input field
          if (validate_email(email) == false || validate_password(password) == false){
              alert('Email or Password is not correct') 
              return
              // Don't continue running the code
          }

          auth.signInWithEmailAndPassword(email, password)
          .then (function(){
              var user = auth.currentUser

              // Add this user to Firebase Database
              var database_ref = database.ref()
          
              //Create User data
              var user_data = {
                  last_login: Date.now()
              }
          
              database_ref.child('users/' + user.uid).update(user_data)
          
          
              alert('User Logged In')
          })
          .catch (function(error){
              var error_code = error.code
              var error_message = err.message
          
              alert(error_message)
          })

      }


      // Validate Functions
      function validate_email(email){
          expression = /^[^@]+@\w+(\.\w+)+\w$/
          if (expression.test(email) == true) {
              return true
          } else {
              return false
          }
      }

      function validate_password(password) {
          if(password <6){
              return false
          } else {
              return true
          }
      }
  </script>


</html>
